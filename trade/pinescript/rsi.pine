//@version=6
strategy("Basic RSI Strategy", overlay=false, initial_capital=10000, default_qty_type=strategy.percent_of_equity, default_qty_value=20000, margin_long = 1./500*75, margin_short = 1./500*75)

// Input parameters
rsiLength = input(8, "RSI Length")
rsiOverbought = input(75, "RSI Overbought Level")
rsiOversold = input(25, "RSI Oversold Level")

// Risk management inputs
stopLossAmount = input.float(2000.0, "Stop Loss $", minval=100.0, maxval=10000)
takeProfitAmount = input.float(5000.0, "Take Profit $", minval=100.0, maxval=20000)
rsiExitDelta = input.float(15.0, "RSI Exit Improvement", minval=1.0, maxval=50.0)

// Time filter inputs
sessionString = "0700-2100:23456"  // Trading from 7 AM to 9 PM, Monday through Friday
isIntraday = timeframe.isintraday
isWithinSession = na(time(timeframe.period, sessionString)) == false

// Calculate RSI
rsiValue = ta.rsi(close, rsiLength)

// Strategy conditions
longCondition = ta.crossover(rsiValue, rsiOversold) and isWithinSession
shortCondition = ta.crossunder(rsiValue, rsiOverbought) and isWithinSession

// Plot RSI
plot(rsiValue, "RSI", color=color.blue)
hline(rsiOverbought, "Overbought", color=color.red)
hline(rsiOversold, "Oversold", color=color.green)

// Calculate pip value (simplified for USD account trading USD pairs)
pipValue = strategy.position_size != 0 ? (0.0001 * math.abs(strategy.position_size)) : 0.0

// RSI exit conditions
longExitRsi = ta.crossunder(rsiValue, rsiOverbought - rsiExitDelta)
shortExitRsi = ta.crossover(rsiValue, rsiOversold + rsiExitDelta)

// Execute trades with built-in stops
if (longCondition)
    strategy.entry("Long", strategy.long)
    strategy.exit("Long Exit", "Long", loss = stopLossAmount, profit = takeProfitAmount)

if (shortCondition)
    strategy.entry("Short", strategy.short)
    strategy.exit("Short Exit", "Short", loss = stopLossAmount, profit = takeProfitAmount)

// RSI exit condition
if (strategy.position_size != 0)
    if ((strategy.position_size > 0 and longExitRsi) or (strategy.position_size < 0 and shortExitRsi))
        strategy.close_all()

// Debug plots
plot(pipValue, "Pip Value", color=color.yellow)
plot(strategy.openprofit, "Raw P&L", color=color.yellow)
plot(strategy.equity, "Account Equity", color=color.white)
